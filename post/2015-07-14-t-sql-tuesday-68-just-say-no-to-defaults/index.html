<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>T-SQL Tuesday 68 - Just Say No to Defaults - cjsommer.com</title><meta name=description content="

Here is a link to the official #tsql2sday invitation from Andy Yun&rsquo;s Blog. This month&rsquo;s subject is &ldquo;Just Say No to Defaults&rdquo;. If you&rsquo;ve read my blog at all you will know that I have a slight obsession with SQL Server and PowerShell. As far as I am concerned PowerShell is the new gold standard when it comes to scripting and automation in the Windows environment. Add a sprinkle of SQL Server with the SQL Server PowerShell module  (SQLPS) and you have a deadly combination as a DBA."><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"cjsommer.com","url":"https:\/\/www.cjsommer.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/www.cjsommer.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/www.cjsommer.com\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/www.cjsommer.com\/post\/2015-07-14-t-sql-tuesday-68-just-say-no-to-defaults\/","name":"T SQL tuesday 68 just say no to defaults"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"cjsommer@gmail.com"},"headline":"T-SQL Tuesday 68 - Just Say No to Defaults","description":" Here is a link to the official #tsql2sday invitation from Andy Yun\u0026rsquo;s Blog. This month\u0026rsquo;s subject is \u0026ldquo;Just Say No to Defaults\u0026rdquo;. If you\u0026rsquo;ve read my blog at all you will know that I have a slight obsession with SQL Server and PowerShell. As far as I am concerned PowerShell is the new gold standard when it comes to scripting and automation in the Windows environment. Add a sprinkle of SQL Server with the SQL Server PowerShell module (SQLPS) and you have a deadly combination as a DBA.\n","inLanguage":"en","wordCount":482,"datePublished":"2015-07-14T08:00:00\u002b00:00","dateModified":"2015-07-14T08:00:00\u002b00:00","image":"https:\/\/www.cjsommer.com\/img\/cjsommer-avatar-2.jpg","keywords":["Powershell, SQL Server"],"mainEntityOfPage":"https:\/\/www.cjsommer.com\/post\/2015-07-14-t-sql-tuesday-68-just-say-no-to-defaults\/","publisher":{"@type":"Organization","name":"https:\/\/www.cjsommer.com\/","logo":{"@type":"ImageObject","url":"https:\/\/www.cjsommer.com\/img\/cjsommer-avatar-2.jpg","height":60,"width":60}}}</script><meta property="og:title" content="T-SQL Tuesday 68 - Just Say No to Defaults"><meta property="og:description" content="

Here is a link to the official #tsql2sday invitation from Andy Yun&rsquo;s Blog. This month&rsquo;s subject is &ldquo;Just Say No to Defaults&rdquo;. If you&rsquo;ve read my blog at all you will know that I have a slight obsession with SQL Server and PowerShell. As far as I am concerned PowerShell is the new gold standard when it comes to scripting and automation in the Windows environment. Add a sprinkle of SQL Server with the SQL Server PowerShell module  (SQLPS) and you have a deadly combination as a DBA."><meta property="og:image" content="https://www.cjsommer.com/img/cjsommer-avatar-2.jpg"><meta property="og:url" content="https://www.cjsommer.com/post/2015-07-14-t-sql-tuesday-68-just-say-no-to-defaults/"><meta property="og:type" content="website"><meta property="og:site_name" content="cjsommer.com"><meta name=twitter:title content="T-SQL Tuesday 68 - Just Say No to Defaults"><meta name=twitter:description content="

Here is a link to the official #tsql2sday invitation from Andy Yun&rsquo;s Blog. This month&rsquo;s subject is &ldquo;Just Say No to Defaults&rdquo;. If you&rsquo;ve read my blog at all you will â€¦</!--></!--></!--></!--></!--></!-->"><meta name=twitter:image content="https://www.cjsommer.com/img/cjsommer-avatar-2.jpg"><meta name=twitter:card content="summary_large_image"><link href=https://www.cjsommer.com/img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.150.0"><link rel=alternate href=https://www.cjsommer.com/index.xml type=application/rss+xml title=cjsommer.com><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.6.0/css/all.css integrity=sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=https://www.cjsommer.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://www.cjsommer.com/css/highlight.min.css><link rel=stylesheet href=https://www.cjsommer.com/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://www.cjsommer.com/>cjsommer.com</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Home href=/>Home</a></li><li><a title="SQL Server" href=/tags/sql-server/>SQL Server</a></li><li><a title=PowerShell href=/tags/powershell/>PowerShell</a></li><li><a title=Professional href=/tags/professional/>Professional</a></li><li><a title=About href=/page/about/>About</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title=cjsommer.com href=https://www.cjsommer.com/><img class=avatar-img src=https://www.cjsommer.com/img/cjsommer-avatar-2.jpg alt=cjsommer.com></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>T-SQL Tuesday 68 - Just Say No to Defaults</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 14, 2015
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;482&nbsp;words</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>Here is a link to the official #tsql2sday invitation from Andy Yun&rsquo;s Blog. This month&rsquo;s subject is &ldquo;Just Say No to Defaults&rdquo;. If you&rsquo;ve read my blog at all you will know that I have a slight obsession with SQL Server and PowerShell. As far as I am concerned PowerShell is the new gold standard when it comes to scripting and automation in the Windows environment. Add a sprinkle of SQL Server with the SQL Server PowerShell module (SQLPS) and you have a deadly combination as a DBA.</p><p>So lets start saying no to defaults! One setting I always change when I install SQL Server are the MinServerMemory and MaxServerMemory values. This blog post will demonstrate how to use PowerShell and SMO to set these values programmatically, based on the amount of RAM in the machine you are running it on.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Load SQLPS</span>
</span></span><span style=display:flex><span>Push-Location; Import-Module SQLPS -DisableNameChecking; Pop-Location
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Microsoft.SqlServer.Management.Smo.Server</span>
</span></span><span style=display:flex><span>$SqlServerName = <span style=color:#e6db74>&#34;localhost\inst1&#34;</span>
</span></span><span style=display:flex><span>$SrvObject = New-Object <span style=color:#e6db74>&#39;Microsoft.SqlServer.Management.Smo.Server&#39;</span> $SQLServerName
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Test the connection</span>
</span></span><span style=display:flex><span>$SrvObject.ConnectionContext.Connect()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Find the correct configuration property for memory</span>
</span></span><span style=display:flex><span>$SrvObject.Configuration | Get-Member *memory*
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Display the Min and MaxServerMemory configuration properties</span>
</span></span><span style=display:flex><span>$SrvObject.Configuration.MinServerMemory 
</span></span><span style=display:flex><span>$SrvObject.Configuration.MaxServerMemory 
</span></span></code></pre></div><p>Only MaxServerMemory is shown in the output, but the MinServerMemory properties are identical. Actually, the properties for all of the SQL Server Configuration items are the same. They all contain the following 9 properties.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Set the MaxServerMemory</span>
</span></span><span style=display:flex><span>$SrvObject.Configuration.MaxServerMemory.ConfigValue = <span style=color:#ae81ff>128</span>
</span></span><span style=display:flex><span>$SrvObject.Configuration.MaxServerMemory.ConfigValue = <span style=color:#ae81ff>512</span>
</span></span><span style=display:flex><span>$SrvObject.Configuration.Alter()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Programmatically Alter the MinServerMemory and MaxServerMemory</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Load SQLPS</span>
</span></span><span style=display:flex><span>Push-Location; Import-Module SQLPS -DisableNameChecking; Pop-Location
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e># Microsoft.SqlServer.Management.Smo.Server</span>
</span></span><span style=display:flex><span>$SqlServerName = <span style=color:#e6db74>&#34;localhost\inst1&#34;</span>
</span></span><span style=display:flex><span>$SrvObject = New-Object <span style=color:#e6db74>&#39;Microsoft.SqlServer.Management.Smo.Server&#39;</span> $SQLServerName
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e># Test the connection</span>
</span></span><span style=display:flex><span>$SrvObject.ConnectionContext.Connect()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Get total physical memory in the machine. There&#39;s more than 1 way to skin this cat.</span>
</span></span><span style=display:flex><span>$TotalRam = [<span style=color:#66d9ef>int</span>]((Get-WmiObject Win32_OperatingSystem | Select-Object -ExpandProperty TotalVisibleMemorySize) / <span style=color:#ae81ff>1024</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set the Max to 90% of physical memory and Min to 1/2 of Max memory.</span>
</span></span><span style=display:flex><span>[<span style=color:#66d9ef>int</span>]$MaxMem = $TotalRam * <span style=color:#ae81ff>.9</span>
</span></span><span style=display:flex><span>[<span style=color:#66d9ef>int</span>]$MinMem = $MaxMem / <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Alter the SQL Server configuration values</span>
</span></span><span style=display:flex><span>$SrvObject.Configuration.MaxServerMemory.ConfigValue = $MaxMem
</span></span><span style=display:flex><span>$SrvObject.Configuration.MinServerMemory.ConfigValue = $MinMem
</span></span><span style=display:flex><span>$SrvObject.Configuration.Alter()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Display the new values</span>
</span></span><span style=display:flex><span>$SrvObject.Configuration.MaxServerMemory
</span></span><span style=display:flex><span>$SrvObject.Configuration.MinServerMemory
</span></span></code></pre></div><p>The full script displays the MinServerMemory and MaxServerMemory configuration values after the modification so you can see that your script worked as expected.</p><p>And there you have it. You can use PowerShell and SMO to set your MinServerMemory and MaxServerMemory settings based on the physical amount of RAM in your system. As a disclaimer, my calculations for MinServerMemory and MaxServerMemory is just what I used for this demo and in no way a standard for everything. I just needed a simple example to show. You could make the logic as simple or complex as you like. That part is up to you to figure out!</p><p>Just as with SQL Server itself, you can also manage SQL Server Agent configurations using PowerShell and SMO. Here is a link to that blog post for Managing SQL Server Agent Configuration with PowerShell in case you&rsquo;re interested.</p><p>Enjoy and happy scripting!</p><div class=blog-tags><a href=https://www.cjsommer.com/tags/powershell/>Powershell</a>&nbsp;
<a href=https://www.cjsommer.com/tags/sql-server/>SQL Server</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fwww.cjsommer.com%2fpost%2f2015-07-14-t-sql-tuesday-68-just-say-no-to-defaults%2f&amp;text=T-SQL%20Tuesday%2068%20-%20Just%20Say%20No%20to%20Defaults&amp;via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.cjsommer.com%2fpost%2f2015-07-14-t-sql-tuesday-68-just-say-no-to-defaults%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fwww.cjsommer.com%2fpost%2f2015-07-14-t-sql-tuesday-68-just-say-no-to-defaults%2f&amp;title=T-SQL%20Tuesday%2068%20-%20Just%20Say%20No%20to%20Defaults" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.cjsommer.com%2fpost%2f2015-07-14-t-sql-tuesday-68-just-say-no-to-defaults%2f&amp;title=T-SQL%20Tuesday%2068%20-%20Just%20Say%20No%20to%20Defaults" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fwww.cjsommer.com%2fpost%2f2015-07-14-t-sql-tuesday-68-just-say-no-to-defaults%2f&amp;title=T-SQL%20Tuesday%2068%20-%20Just%20Say%20No%20to%20Defaults" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fwww.cjsommer.com%2fpost%2f2015-07-14-t-sql-tuesday-68-just-say-no-to-defaults%2f&amp;description=T-SQL%20Tuesday%2068%20-%20Just%20Say%20No%20to%20Defaults" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section><h4 class=see-also>See also</h4><ul><li><a href=/post/2020-10-13-qds-gottchas/>QDS Forced Plans - Gotchas and Limitations</a></li><li><a href=/post/2018-03-02-speaking-at-sqlsaturday-723/>SQL Saturday 723, March 24, 2018 in Rochester, NY. Join us and kick your SQL Server knowledge up a notch!</a></li><li><a href=/post/2017-11-14-tsql2sday-96-folks-who-made-a-difference/>T-SQL Tuesday 96 - Folks Who Have Made a Difference</a></li><li><a href=/post/2017-09-11-tsql2sday-94-do-you-wanna-get-posh/>T-SQL Tuesday 94 - Do you wanna get PoSh?</a></li><li><a href=/post/2017-08-28-wilt-configure-tempdb-rds/>What I Learned Today - Configuring tempdb in RDS</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://www.cjsommer.com/post/2015-06-16-sql-server-pbm-by-example/ data-toggle=tooltip data-placement=top title="SQL Server Policy Based Management by Example">&larr; Previous Post</a></li><li class=next><a href=https://www.cjsommer.com/post/2015-07-28-present-at-sql-saturday-386-achievement-unlocked/ data-toggle=tooltip data-placement=top title="Present at SQL Saturday">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">&nbsp;&bull;&nbsp;&copy;
2020
&nbsp;&bull;&nbsp;
<a href=https://www.cjsommer.com/>cjsommer.com</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.150.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity=sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script><script src=https://www.cjsommer.com/js/main.js></script><script src=https://www.cjsommer.com/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://www.cjsommer.com/js/load-photoswipe.js></script></body></html>